{"ast":null,"code":"var _jsxFileName = \"/Users/chi/Projects/Web/albums-2.0/src/components/Layout/Layout.js\";\nimport React from \"react\";\nimport Header from \"./Header\";\nimport Content from \"./Content\";\nimport Footer from \"./Footer\";\nimport Modal from \"react-modal\";\nimport AlbumsButton from '../glamorous/AlbumsButton';\nimport AddAlbumBlock from \"./AddAlbumBlock\";\nimport HeadText from '../glamorous/HeadText';\nimport request from 'superagent';\nimport glamorous from 'glamorous';\nimport { serverUrl } from '../../config';\nimport AlbumsListModel from \"../../models/AlbumsList.js\";\nconst LayoutBlock = glamorous.div({\n  margin: '0 auto',\n  maxWidth: 900,\n  minHeight: '100%'\n});\nconst customStyles = {\n  content: {\n    top: '50%',\n    left: '50%',\n    right: 'auto',\n    bottom: 'auto',\n    textAlign: 'center',\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'space-around',\n    alignItems: 'center',\n    transform: 'translate(-50%, -50%)'\n  }\n};\nconst errorCustomStyles = {\n  content: {\n    top: '50%',\n    left: '50%',\n    maxHeight: '90px',\n    right: 'auto',\n    bottom: 'auto',\n    textAlign: 'center',\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'space-around',\n    alignItems: 'center',\n    transform: 'translate(-50%, -50%)'\n  }\n};\nlet d = new Date();\nlet year = d.getFullYear() - 1;\nlet month = d.getMonth() + 1;\nif (month < 10) month = \"0\" + month;\nconst albumsStore = new AlbumsListModel(year, month);\nwindow.store = albumsStore;\n\nasync function getAlbums(year, month) {\n  const params = {\n    action: 'list',\n    year: year,\n    month: month\n  };\n  let response = await fetch(serverUrl, {\n    method: 'post',\n    body: JSON.stringify(params)\n  });\n  let data = await response.json();\n  return data;\n}\n\nexport default class Layout extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      loading: false,\n      uploading: false,\n      addModalOpen: false,\n      errorModalOpen: false,\n      errorText: \"\",\n      addModalMode: \"add\",\n      editedAlbum: false\n    };\n  }\n\n  componentWillMount() {\n    Modal.setAppElement('body');\n  }\n\n  componentDidMount() {\n    this.list();\n  }\n\n  list() {\n    console.log('list', albumsStore.year, albumsStore.month);\n    this.setState({\n      loading: true\n    });\n\n    if (albumsStore.addedDates[albumsStore.year] && albumsStore.addedDates[albumsStore.year][albumsStore.month]) {\n      this.setState({\n        loading: false\n      });\n      return;\n    }\n\n    getAlbums(albumsStore.year, albumsStore.month).then(data => console.log('ASYNC data', data));\n    request.post(serverUrl).send('action=list').send('year=' + albumsStore.year).send('month=' + albumsStore.month).end(function (err, res) {\n      console.log('res', res);\n\n      if (res.body && res.body.ok && Array.isArray(res.body.albums)) {\n        albumsStore.addDate(albumsStore.year, albumsStore.month);\n        res.body.albums.forEach(function (album) {\n          console.log('album', album);\n          albumsStore.addAlbum(album);\n        });\n      } else this.setState({\n        errorModalOpen: true,\n        errorText: \"Error loading albums\"\n      });\n\n      this.setState({\n        loading: false\n      });\n    }.bind(this));\n  }\n\n  addCallbackOk(res) {\n    albumsStore.year = res.year;\n    albumsStore.month = res.month;\n\n    if (this.state.editedAlbum) {\n      delete res['ok'];\n      albumsStore.editAlbum(res);\n    }\n\n    this.list();\n    this.closeAddModal();\n  }\n\n  addCallbackError(error, close) {\n    console.log('error', error);\n    if (close) this.closeAddModal();\n    this.setState({\n      errorModalOpen: true,\n      errorText: error\n    });\n  }\n\n  delCallbackOk(res) {\n    albumsStore.deleteAlbum(res.id);\n    this.list();\n    this.closeAddModal();\n  }\n\n  delCallbackError(error) {\n    this.setState({\n      errorModalOpen: true,\n      errorText: error\n    });\n  }\n\n  openAddModal() {\n    this.setState({\n      addModalOpen: true,\n      addModalMode: 'add',\n      editedAlbum: false\n    });\n  }\n\n  openEditModal(item) {\n    this.setState({\n      addModalOpen: true,\n      addModalMode: 'edit',\n      editedAlbum: item\n    });\n  }\n\n  closeAddModal() {\n    this.setState({\n      addModalOpen: false\n    });\n  }\n\n  openErrorModal(text) {\n    this.setState({\n      errorModalOpen: true,\n      errorText: text\n    });\n  }\n\n  closeErrorModal() {\n    this.setState({\n      errorModalOpen: false\n    });\n  }\n\n  changeDate() {\n    console.log('change date');\n    this.list();\n  }\n\n  render() {\n    return React.createElement(LayoutBlock, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    }, React.createElement(Header, {\n      changeDate: this.changeDate.bind(this),\n      albumsStore: albumsStore,\n      add: this.openAddModal.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181\n      },\n      __self: this\n    }), React.createElement(Content, {\n      albumsStore: albumsStore,\n      add: this.openAddModal.bind(this),\n      loading: this.state.loading,\n      openEditModal: this.openEditModal.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    }), React.createElement(Footer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183\n      },\n      __self: this\n    }), React.createElement(Modal, {\n      isOpen: this.state.addModalOpen,\n      onRequestClose: this.closeAddModal.bind(this),\n      style: customStyles,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    }, React.createElement(AddAlbumBlock, {\n      year: albumsStore.year,\n      month: albumsStore.month,\n      okCallback: this.addCallbackOk.bind(this),\n      errorCallback: this.addCallbackError.bind(this),\n      delCallbackOk: this.delCallbackOk.bind(this),\n      delCallbackError: this.delCallbackError.bind(this),\n      addModalMode: this.state.addModalMode,\n      editedAlbum: this.state.editedAlbum,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185\n      },\n      __self: this\n    })), React.createElement(Modal, {\n      isOpen: this.state.errorModalOpen,\n      onRequestClose: this.closeErrorModal.bind(this),\n      style: errorCustomStyles,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194\n      },\n      __self: this\n    }, React.createElement(HeadText, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195\n      },\n      __self: this\n    }, this.state.errorText), React.createElement(AlbumsButton, {\n      onClick: this.closeErrorModal.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196\n      },\n      __self: this\n    }, \"OK\")));\n  }\n\n}","map":{"version":3,"sources":["/Users/chi/Projects/Web/albums-2.0/src/components/Layout/Layout.js"],"names":["React","Header","Content","Footer","Modal","AlbumsButton","AddAlbumBlock","HeadText","request","glamorous","serverUrl","AlbumsListModel","LayoutBlock","div","margin","maxWidth","minHeight","customStyles","content","top","left","right","bottom","textAlign","display","flexDirection","justifyContent","alignItems","transform","errorCustomStyles","maxHeight","d","Date","year","getFullYear","month","getMonth","albumsStore","window","store","getAlbums","params","action","response","fetch","method","body","JSON","stringify","data","json","Layout","Component","constructor","state","loading","uploading","addModalOpen","errorModalOpen","errorText","addModalMode","editedAlbum","componentWillMount","setAppElement","componentDidMount","list","console","log","setState","addedDates","then","post","send","end","err","res","ok","Array","isArray","albums","addDate","forEach","album","addAlbum","bind","addCallbackOk","editAlbum","closeAddModal","addCallbackError","error","close","delCallbackOk","deleteAlbum","id","delCallbackError","openAddModal","openEditModal","item","openErrorModal","text","closeErrorModal","changeDate","render"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,OAAP,MAAoB,WAApB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AAEA,OAAOC,KAAP,MAAkB,aAAlB;AAEA,OAAOC,YAAP,MAAyB,2BAAzB;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,QAAP,MAAqB,uBAArB;AAEA,OAAOC,OAAP,MAAoB,YAApB;AACA,OAAOC,SAAP,MAAsB,WAAtB;AAEA,SAASC,SAAT,QAA0B,cAA1B;AAEA,OAAOC,eAAP,MAA4B,4BAA5B;AAEA,MAAMC,WAAW,GAAGH,SAAS,CAACI,GAAV,CAAc;AACjCC,EAAAA,MAAM,EAAE,QADyB;AAEjCC,EAAAA,QAAQ,EAAE,GAFuB;AAGjCC,EAAAA,SAAS,EAAE;AAHsB,CAAd,CAApB;AAMA,MAAMC,YAAY,GAAG;AACpBC,EAAAA,OAAO,EAAG;AACTC,IAAAA,GAAG,EAAqB,KADf;AAETC,IAAAA,IAAI,EAAoB,KAFf;AAGTC,IAAAA,KAAK,EAAmB,MAHf;AAITC,IAAAA,MAAM,EAAkB,MAJf;AAKTC,IAAAA,SAAS,EAAc,QALd;AAMTC,IAAAA,OAAO,EAAkB,MANhB;AAOTC,IAAAA,aAAa,EAAW,QAPf;AAQTC,IAAAA,cAAc,EAAG,cARR;AASTC,IAAAA,UAAU,EAAG,QATJ;AAUTC,IAAAA,SAAS,EAAe;AAVf;AADU,CAArB;AAeA,MAAMC,iBAAiB,GAAG;AACzBX,EAAAA,OAAO,EAAG;AACTC,IAAAA,GAAG,EAAqB,KADf;AAETC,IAAAA,IAAI,EAAoB,KAFf;AAGNU,IAAAA,SAAS,EAAc,MAHjB;AAITT,IAAAA,KAAK,EAAmB,MAJf;AAKTC,IAAAA,MAAM,EAAkB,MALf;AAMTC,IAAAA,SAAS,EAAc,QANd;AAOTC,IAAAA,OAAO,EAAkB,MAPhB;AAQTC,IAAAA,aAAa,EAAW,QARf;AASTC,IAAAA,cAAc,EAAG,cATR;AAUTC,IAAAA,UAAU,EAAG,QAVJ;AAWTC,IAAAA,SAAS,EAAe;AAXf;AADe,CAA1B;AAgBA,IAAIG,CAAC,GAAG,IAAIC,IAAJ,EAAR;AACA,IAAIC,IAAI,GAAGF,CAAC,CAACG,WAAF,KAAkB,CAA7B;AACA,IAAIC,KAAK,GAAGJ,CAAC,CAACK,QAAF,KAAe,CAA3B;AACA,IAAID,KAAK,GAAG,EAAZ,EAAgBA,KAAK,GAAG,MAAIA,KAAZ;AAEhB,MAAME,WAAW,GAAG,IAAI1B,eAAJ,CAAoBsB,IAApB,EAA0BE,KAA1B,CAApB;AACAG,MAAM,CAACC,KAAP,GAAeF,WAAf;;AAEA,eAAeG,SAAf,CAAyBP,IAAzB,EAA+BE,KAA/B,EAAsC;AACrC,QAAMM,MAAM,GAAG;AACdC,IAAAA,MAAM,EAAE,MADM;AAEdT,IAAAA,IAAI,EAAEA,IAFQ;AAGdE,IAAAA,KAAK,EAAEA;AAHO,GAAf;AAKA,MAAIQ,QAAQ,GAAG,MAAMC,KAAK,CAAClC,SAAD,EAAY;AACrCmC,IAAAA,MAAM,EAAE,MAD6B;AAErCC,IAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeP,MAAf;AAF+B,GAAZ,CAA1B;AAIA,MAAIQ,IAAI,GAAG,MAAMN,QAAQ,CAACO,IAAT,EAAjB;AACA,SAAOD,IAAP;AACA;;AAED,eAAe,MAAME,MAAN,SAAqBnD,KAAK,CAACoD,SAA3B,CAAqC;AAClDC,EAAAA,WAAW,GAAG;AACb;AACA,SAAKC,KAAL,GAAa;AACZC,MAAAA,OAAO,EAAG,KADE;AAEZC,MAAAA,SAAS,EAAG,KAFA;AAGZC,MAAAA,YAAY,EAAG,KAHH;AAIZC,MAAAA,cAAc,EAAG,KAJL;AAKZC,MAAAA,SAAS,EAAG,EALA;AAMZC,MAAAA,YAAY,EAAG,KANH;AAOZC,MAAAA,WAAW,EAAG;AAPF,KAAb;AASA;;AAEDC,EAAAA,kBAAkB,GAAG;AACpB1D,IAAAA,KAAK,CAAC2D,aAAN,CAAoB,MAApB;AACA;;AAEDC,EAAAA,iBAAiB,GAAG;AAClB,SAAKC,IAAL;AACD;;AAEDA,EAAAA,IAAI,GAAG;AACTC,IAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoB9B,WAAW,CAACJ,IAAhC,EAAsCI,WAAW,CAACF,KAAlD;AACC,SAAKiC,QAAL,CAAc;AAAEb,MAAAA,OAAO,EAAE;AAAX,KAAd;;AACC,QAAIlB,WAAW,CAACgC,UAAZ,CAAuBhC,WAAW,CAACJ,IAAnC,KAA4CI,WAAW,CAACgC,UAAZ,CAAuBhC,WAAW,CAACJ,IAAnC,EAAyCI,WAAW,CAACF,KAArD,CAAhD,EAA6G;AAC7G,WAAKiC,QAAL,CAAc;AAAEb,QAAAA,OAAO,EAAE;AAAX,OAAd;AACA;AACC;;AAEDf,IAAAA,SAAS,CAACH,WAAW,CAACJ,IAAb,EAAmBI,WAAW,CAACF,KAA/B,CAAT,CAA+CmC,IAA/C,CAAoDrB,IAAI,IAAIiB,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BlB,IAA1B,CAA5D;AACCzC,IAAAA,OAAO,CAAC+D,IAAR,CAAa7D,SAAb,EACQ8D,IADR,CACa,aADb,EAEQA,IAFR,CAEa,UAAQnC,WAAW,CAACJ,IAFjC,EAGQuC,IAHR,CAGa,WAASnC,WAAW,CAACF,KAHlC,EAIQsC,GAJR,CAIY,UAASC,GAAT,EAAcC,GAAd,EAAmB;AAAET,MAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAmBQ,GAAnB;;AAC/B,UAAIA,GAAG,CAAC7B,IAAJ,IAAY6B,GAAG,CAAC7B,IAAJ,CAAS8B,EAArB,IAA2BC,KAAK,CAACC,OAAN,CAAcH,GAAG,CAAC7B,IAAJ,CAASiC,MAAvB,CAA/B,EAA+D;AAC/D1C,QAAAA,WAAW,CAAC2C,OAAZ,CAAoB3C,WAAW,CAACJ,IAAhC,EAAsCI,WAAW,CAACF,KAAlD;AACAwC,QAAAA,GAAG,CAAC7B,IAAJ,CAASiC,MAAT,CAAgBE,OAAhB,CAAwB,UAASC,KAAT,EAAgB;AACvChB,UAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBe,KAArB;AACA7C,UAAAA,WAAW,CAAC8C,QAAZ,CAAqBD,KAArB;AACA,SAHD;AAIC,OAND,MAOK,KAAKd,QAAL,CAAc;AAAEV,QAAAA,cAAc,EAAG,IAAnB;AAAyBC,QAAAA,SAAS,EAAG;AAArC,OAAd;;AAEL,WAAKS,QAAL,CAAc;AAAEb,QAAAA,OAAO,EAAE;AAAX,OAAd;AACA,KAXU,CAWT6B,IAXS,CAWJ,IAXI,CAJZ;AAgBA;;AAEDC,EAAAA,aAAa,CAACV,GAAD,EAAM;AACpBtC,IAAAA,WAAW,CAACJ,IAAZ,GAAmB0C,GAAG,CAAC1C,IAAvB;AACAI,IAAAA,WAAW,CAACF,KAAZ,GAAoBwC,GAAG,CAACxC,KAAxB;;AACA,QAAI,KAAKmB,KAAL,CAAWO,WAAf,EAA4B;AAC3B,aAAOc,GAAG,CAAC,IAAD,CAAV;AACAtC,MAAAA,WAAW,CAACiD,SAAZ,CAAsBX,GAAtB;AACA;;AACD,SAAKV,IAAL;AACA,SAAKsB,aAAL;AACE;;AAEDC,EAAAA,gBAAgB,CAACC,KAAD,EAAQC,KAAR,EAAe;AAAExB,IAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBsB,KAArB;AAChC,QAAIC,KAAJ,EAAW,KAAKH,aAAL;AACX,SAAKnB,QAAL,CAAc;AAAEV,MAAAA,cAAc,EAAG,IAAnB;AAAyBC,MAAAA,SAAS,EAAG8B;AAArC,KAAd;AACA;;AAEDE,EAAAA,aAAa,CAAChB,GAAD,EAAM;AAClBtC,IAAAA,WAAW,CAACuD,WAAZ,CAAwBjB,GAAG,CAACkB,EAA5B;AACA,SAAK5B,IAAL;AACA,SAAKsB,aAAL;AACA;;AAEDO,EAAAA,gBAAgB,CAACL,KAAD,EAAQ;AACvB,SAAKrB,QAAL,CAAc;AAAEV,MAAAA,cAAc,EAAG,IAAnB;AAAyBC,MAAAA,SAAS,EAAG8B;AAArC,KAAd;AACA;;AAEDM,EAAAA,YAAY,GAAG;AACd,SAAK3B,QAAL,CAAc;AAACX,MAAAA,YAAY,EAAG,IAAhB;AAAsBG,MAAAA,YAAY,EAAG,KAArC;AAA4CC,MAAAA,WAAW,EAAG;AAA1D,KAAd;AACA;;AAEDmC,EAAAA,aAAa,CAACC,IAAD,EAAO;AACnB,SAAK7B,QAAL,CAAc;AAACX,MAAAA,YAAY,EAAE,IAAf;AAAqBG,MAAAA,YAAY,EAAG,MAApC;AAA4CC,MAAAA,WAAW,EAAGoC;AAA1D,KAAd;AACA;;AAEDV,EAAAA,aAAa,GAAG;AACf,SAAKnB,QAAL,CAAc;AAACX,MAAAA,YAAY,EAAG;AAAhB,KAAd;AACA;;AAEDyC,EAAAA,cAAc,CAACC,IAAD,EAAO;AACpB,SAAK/B,QAAL,CAAc;AAACV,MAAAA,cAAc,EAAG,IAAlB;AAAwBC,MAAAA,SAAS,EAAGwC;AAApC,KAAd;AACA;;AAEDC,EAAAA,eAAe,GAAG;AACjB,SAAKhC,QAAL,CAAc;AAACV,MAAAA,cAAc,EAAG;AAAlB,KAAd;AACA;;AAED2C,EAAAA,UAAU,GAAG;AAAEnC,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;AACd,SAAKF,IAAL;AACA;;AAEDqC,EAAAA,MAAM,GAAG;AACP,WACE,oBAAC,WAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,oBAAC,MAAD;AAAQ,MAAA,UAAU,EAAE,KAAKD,UAAL,CAAgBjB,IAAhB,CAAqB,IAArB,CAApB;AAAgD,MAAA,WAAW,EAAE/C,WAA7D;AAA0E,MAAA,GAAG,EAAE,KAAK0D,YAAL,CAAkBX,IAAlB,CAAuB,IAAvB,CAA/E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADD,EAEC,oBAAC,OAAD;AAAS,MAAA,WAAW,EAAE/C,WAAtB;AAAmC,MAAA,GAAG,EAAE,KAAK0D,YAAL,CAAkBX,IAAlB,CAAuB,IAAvB,CAAxC;AAAsE,MAAA,OAAO,EAAE,KAAK9B,KAAL,CAAWC,OAA1F;AAAmG,MAAA,aAAa,EAAE,KAAKyC,aAAL,CAAmBZ,IAAnB,CAAwB,IAAxB,CAAlH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFD,EAGC,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAHD,EAIC,oBAAC,KAAD;AAAO,MAAA,MAAM,EAAE,KAAK9B,KAAL,CAAWG,YAA1B;AAAwC,MAAA,cAAc,EAAE,KAAK8B,aAAL,CAAmBH,IAAnB,CAAwB,IAAxB,CAAxD;AAAuF,MAAA,KAAK,EAAEnE,YAA9F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACJ,oBAAC,aAAD;AAAe,MAAA,IAAI,EAAEoB,WAAW,CAACJ,IAAjC;AACM,MAAA,KAAK,EAAEI,WAAW,CAACF,KADzB;AAEM,MAAA,UAAU,EAAE,KAAKkD,aAAL,CAAmBD,IAAnB,CAAwB,IAAxB,CAFlB;AAGM,MAAA,aAAa,EAAE,KAAKI,gBAAL,CAAsBJ,IAAtB,CAA2B,IAA3B,CAHrB;AAIM,MAAA,aAAa,EAAE,KAAKO,aAAL,CAAmBP,IAAnB,CAAwB,IAAxB,CAJrB;AAKM,MAAA,gBAAgB,EAAE,KAAKU,gBAAL,CAAsBV,IAAtB,CAA2B,IAA3B,CALxB;AAMM,MAAA,YAAY,EAAE,KAAK9B,KAAL,CAAWM,YAN/B;AAOM,MAAA,WAAW,EAAE,KAAKN,KAAL,CAAWO,WAP9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADI,CAJD,EAcJ,oBAAC,KAAD;AAAO,MAAA,MAAM,EAAE,KAAKP,KAAL,CAAWI,cAA1B;AAA0C,MAAA,cAAc,EAAE,KAAK0C,eAAL,CAAqBhB,IAArB,CAA0B,IAA1B,CAA1D;AAA2F,MAAA,KAAK,EAAEvD,iBAAlG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAW,KAAKyB,KAAL,CAAWK,SAAtB,CADD,EAEC,oBAAC,YAAD;AAAc,MAAA,OAAO,EAAE,KAAKyC,eAAL,CAAqBhB,IAArB,CAA0B,IAA1B,CAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAFD,CAdI,CADF;AAqBD;;AAzHiD","sourcesContent":["import React from \"react\";\n\nimport Header from \"./Header\";\nimport Content from \"./Content\";\nimport Footer from \"./Footer\";\n\nimport Modal from \"react-modal\";\n\nimport AlbumsButton from '../glamorous/AlbumsButton';\nimport AddAlbumBlock from \"./AddAlbumBlock\";\nimport HeadText from '../glamorous/HeadText';\n\nimport request from 'superagent';\nimport glamorous from 'glamorous';\n\nimport { serverUrl } from '../../config';\n\nimport AlbumsListModel from \"../../models/AlbumsList.js\";\n\nconst LayoutBlock = glamorous.div({\n\tmargin: '0 auto',\n\tmaxWidth: 900,\n\tminHeight: '100%'\n});\n\nconst customStyles = {\n\tcontent : {\n\t\ttop                   : '50%',\n\t\tleft                  : '50%',\n\t\tright                 : 'auto',\n\t\tbottom                : 'auto',\n\t\ttextAlign   :          'center',\n\t\tdisplay    :             'flex',\n\t\tflexDirection :         'column',\n\t\tjustifyContent : 'space-around',\n\t\talignItems : 'center',\n\t\ttransform             : 'translate(-50%, -50%)'\n\t}\n};\n\nconst errorCustomStyles = {\n\tcontent : {\n\t\ttop                   : '50%',\n\t\tleft                  : '50%',\n\t    maxHeight            : '90px',\n\t\tright                 : 'auto',\n\t\tbottom                : 'auto',\n\t\ttextAlign   :          'center',\n\t\tdisplay    :             'flex',\n\t\tflexDirection :         'column',\n\t\tjustifyContent : 'space-around',\n\t\talignItems : 'center',\n\t\ttransform             : 'translate(-50%, -50%)'\n\t}\n}\n\nlet d = new Date();\nlet year = d.getFullYear() - 1;\nlet month = d.getMonth() + 1;\nif (month < 10) month = \"0\"+month;\n\nconst albumsStore = new AlbumsListModel(year, month);\nwindow.store = albumsStore;\n\nasync function getAlbums(year, month) {\n\tconst params = {\n\t\taction: 'list',\n\t\tyear: year,\n\t\tmonth: month\n\t};\n\tlet response = await fetch(serverUrl, {\n\t\tmethod: 'post',\n\t\tbody: JSON.stringify(params)\n\t});\n\tlet data = await response.json();\n\treturn data;\n}\n\nexport default class Layout extends React.Component {\n  constructor() {\n  \tsuper();\n  \tthis.state = {\n  \t\tloading : false,\n  \t\tuploading : false,\n  \t\taddModalOpen : false,\n  \t\terrorModalOpen : false,\n\t\t  errorText : \"\",\n\t\t  addModalMode : \"add\",\n\t\t  editedAlbum : false\n  \t}\n  }\n  \n  componentWillMount() {\n\t  Modal.setAppElement('body');\n  }\n  \n  componentDidMount() {\n    this.list();\n  }\n  \n  list() {\nconsole.log('list', albumsStore.year, albumsStore.month);\n\tthis.setState({ loading: true});\n\t if (albumsStore.addedDates[albumsStore.year] && albumsStore.addedDates[albumsStore.year][albumsStore.month]) {\n\t\tthis.setState({ loading: false}); \n\t\treturn;\n\t }\n     \n\t getAlbums(albumsStore.year, albumsStore.month).then(data => console.log('ASYNC data', data));\n\t  request.post(serverUrl)\n\t         .send('action=list')\n\t         .send('year='+albumsStore.year)\n\t         .send('month='+albumsStore.month)\n\t         .end(function(err, res) { console.log('res', res);\n\t\t\t\t if (res.body && res.body.ok && Array.isArray(res.body.albums)) {\n\t\t\t\t\talbumsStore.addDate(albumsStore.year, albumsStore.month);\n\t\t\t\t\tres.body.albums.forEach(function(album) {\n\t\t\t\t\t\tconsole.log('album', album);\n\t\t\t\t\t\talbumsStore.addAlbum(album);\n\t\t\t\t\t});\n\t\t\t\t }\n\t\t\t\t else this.setState({ errorModalOpen : true, errorText : \"Error loading albums\" });\n\t\t\t\t \n\t\t\t\t this.setState({ loading: false});\n\t\t\t }.bind(this));\n  }\n\n  addCallbackOk(res) {\n\talbumsStore.year = res.year;\n\talbumsStore.month = res.month;\n\tif (this.state.editedAlbum) {\n\t\tdelete res['ok'];\n\t\talbumsStore.editAlbum(res);\n\t}\n\tthis.list();\n\tthis.closeAddModal();\n  }\n  \n  addCallbackError(error, close) { console.log('error', error);\n\t  if (close) this.closeAddModal();\n\t  this.setState({ errorModalOpen : true, errorText : error });\n  }\n  \n  delCallbackOk(res) {\n\t  albumsStore.deleteAlbum(res.id);\n\t  this.list();\n\t  this.closeAddModal();\n  }\n  \n  delCallbackError(error) {\n\t  this.setState({ errorModalOpen : true, errorText : error });\n  }\n  \n  openAddModal() {\n\t  this.setState({addModalOpen : true, addModalMode : 'add', editedAlbum : false});\n  }\n\n  openEditModal(item) {\n\t  this.setState({addModalOpen: true, addModalMode : 'edit', editedAlbum : item});\n  }\n  \n  closeAddModal() {\n\t  this.setState({addModalOpen : false});\n  }\n  \n  openErrorModal(text) {\n\t  this.setState({errorModalOpen : true, errorText : text});\n  }\n  \n  closeErrorModal() {\n\t  this.setState({errorModalOpen : false});\n  }\n  \n  changeDate() { console.log('change date');\n  \tthis.list();\n  }\n  \n  render() {\n    return (\n      <LayoutBlock>\n      \t<Header changeDate={this.changeDate.bind(this)} albumsStore={albumsStore} add={this.openAddModal.bind(this)}/>\n      \t<Content albumsStore={albumsStore} add={this.openAddModal.bind(this)} loading={this.state.loading} openEditModal={this.openEditModal.bind(this)}/>\n      \t<Footer/>\n      \t<Modal isOpen={this.state.addModalOpen} onRequestClose={this.closeAddModal.bind(this)} style={customStyles}>\n\t\t\t<AddAlbumBlock year={albumsStore.year} \n\t\t\t\t\t\t   month={albumsStore.month} \n\t\t\t\t\t\t   okCallback={this.addCallbackOk.bind(this)} \n\t\t\t\t\t\t   errorCallback={this.addCallbackError.bind(this)} \n\t\t\t\t\t\t   delCallbackOk={this.delCallbackOk.bind(this)}\n\t\t\t\t\t\t   delCallbackError={this.delCallbackError.bind(this)}\n\t\t\t\t\t\t   addModalMode={this.state.addModalMode} \n\t\t\t\t\t\t   editedAlbum={this.state.editedAlbum}/>\n\t\t</Modal>\n\t\t<Modal isOpen={this.state.errorModalOpen} onRequestClose={this.closeErrorModal.bind(this)} style={errorCustomStyles}>\n\t\t\t<HeadText>{this.state.errorText}</HeadText>\n\t\t\t<AlbumsButton onClick={this.closeErrorModal.bind(this)}>OK</AlbumsButton>\n\t\t</Modal>\n      </LayoutBlock>\t\n    );\n  }\n}\n\n\n"]},"metadata":{},"sourceType":"module"}